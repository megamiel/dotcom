<div class="sentence" id="kaisetsu"><strong>2相コミットプロトコル</strong>は、トランザクションを他のサイトに更新可能かどうかを確認する第1相と、更新を確定する第2相の2つのフェーズに分け、各サイトのトランザクションをコミットもロールバックも可能な中間状態(セキュア状態)にした後、全サイトがコミットできる場合だけトランザクションをコミットするという方法で分散データベース環境でのトランザクションの原子性・一貫性を保証する手法です。<br/><br/>具体的には、各サイトの更新処理が終わった後に、コミットの調整を行う1つのノードを「主サイト」、ネットワーク上の他のノードを「従サイト」として、次の手順でコミットが行われます。<br/><br/>[第1相(投票層)]<ol><li>主サイトはネットワーク上の全ての従サイトにコミットの可否を問い合わせる。</li><li>全ての従サイトは主サイトにコミットの可否を応答する。</li></ol>[第2相(決定相)]<br/><ol start="3"><li>全ての従サイトからコミットの合意を得られた場合は、全ての従サイトにコミットの実行要求を発行する。コミットの停止を応答した従サイトがあった場合、またはタイムアウトとなった場合は、全ての従サイトにロールバックの実行要求を発行する。</li><li>全ての従サイトは、コミット(またはロールバック)の完了とともに主サイトに処理完了のメッセージを送る。</li><li>主サイトが、全ての従サイトからの処理完了メッセージを受け取り、トランザクションの完了となる。</li></ol><div class="img_margin"><img alt="30.gif" src="https://www.ap-siken.com/kakomon/01_aki/img/30.gif"/></div><ul class="selectList"><li class="lia">第1相で一部の従サイトから応答が得られないまま一定時間が経過した場合、主サイトはトランザクションを中止します。コミット準備完了メッセージを受け取った一部の従サイトだけにコミット要求を出すと、サイトごとにコミットされたりロークバックされたりといったことが起こり、トランザクションの一貫性が保てません。</li><li class="lii">全ての従サイトからコミット準備完了メッセージを得られなかった場合には、主サイトはトランザクションを中止しなければなりません。このケースでは、トランザクションはアボート処理され、再度トランザクションの発行からやり直しになります。</li><li class="liu">正しい。全ての従サイトからコミット可能というメッセージを受け取ったときのみ、主サイトは全ての従サイトにコミット要求を発行します。</li><li class="lie">各従サイトは、コミットできるときにはコミット可(Yes)、できない状態のときにはコミット不可(No)を、主サイトに対して返します。</li></ul></div>